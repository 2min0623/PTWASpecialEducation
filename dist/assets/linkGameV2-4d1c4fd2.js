import{m as I,r as u,o as g,c as p,a as f,t as M,f as k,b as D,w as m,F as C,k as w,q as _,u as v,s as S,_ as b}from"./index-9fea2658.js";import{_ as x}from"./_plugin-vue_export-helper-c27b6911.js";const G={name:"LinkGameV2",components:{ImageContainer:I(()=>b(()=>import("./ManualImageContainer-d968e06e.js"),["assets/ManualImageContainer-d968e06e.js","assets/get_assets-cf714148.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/index-9fea2658.js","assets/index-b23d1a2f.css","assets/ManualImageContainer-493bf4d2.css"]))},data(){return{id:"MA4008",GameData:{Question:{text:"把一樣的數連起來",RowData:[[{Name:"ImageContainer",Data:{Src:"1261.png"}},{Name:"ImageContainer",Data:{Src:"1324.png"}},{Name:"ImageContainer",Data:{Src:"1456.png"}},{Name:"ImageContainer",Data:{Src:"1342.png"}},{Name:"ImageContainer",Data:{Src:"1535.png"}}],[{Name:"ImageContainer",Data:{Src:"c-1456.png"}},{Name:"ImageContainer",Data:{Src:"c-1324.png"}},{Name:"ImageContainer",Data:{Src:"c-1261.png"}},{Name:"ImageContainer",Data:{Src:"c-1535.png"}},{Name:"ImageContainer",Data:{Src:"c-1342.png"}}],[{Name:"ImageContainer",Data:{Src:"n-1324.png"}},{Name:"ImageContainer",Data:{Src:"n-1261.png"}},{Name:"ImageContainer",Data:{Src:"n-1456.png"}},{Name:"ImageContainer",Data:{Src:"n-1342.png"}},{Name:"ImageContainer",Data:{Src:"n-1535.png"}}]]},Answer:[[[0,0],[1,2]],[[0,1],[1,1]],[[0,2],[1,0]],[[0,3],[1,4]],[[0,4],[1,3]],[[2,0],[3,2]],[[2,1],[3,0]],[[2,2],[3,1]],[[2,3],[3,4]],[[2,4],[3,3]]]},configStage:{width:610,height:100},ComponentConfig:[],ComponentPositionConfig:{},DotLocation:[],LineWidth:2,IndexInfo:null,MiniGap:10,Lines:[],OnDrawingLine:{points:[],stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"},OnDrawing:!1,IndexMappingTable:[],MouseDownDotIndex:null}},mounted(){this.IndexInfo=this.$refs.Index.getBoundingClientRect(),this.Init()},created(){},methods:{MouseDown(a,n){const t=a.target.getStage().getPointerPosition();this.OnDrawing=!0,this.MouseDownDotIndex=n,this.OnDrawingLine={points:[t.x,t.y,t.x,t.y],stroke:"black",strokeWidth:this.LineWidth,lineCap:"round",lineJoin:"round"}},MouseMove(a){if(this.OnDrawing){const n=a.target.getStage().getPointerPosition();this.OnDrawingLine.points.splice(2,2,n.x,n.y),this.$refs.OnDrawLineLayer.getNode().draw()}},MouseUpAtDot(a){if(console.log("MouseUpAtDot"),this.OnDrawing){const n=a.target.getStage().getPointerPosition();this.OnDrawingLine.points.splice(2,2,n.x,n.y);let t=this.CheckMouseAtTheDot(n.x,n.y);if(t!=!1&&this.CheckLinkAble(this.MouseDownDotIndex,t)&&this.CheckAnswerisCorrect(this.MouseDownDotIndex,t)){this.OnDrawingLine.points.splice(2,2,this.DotLocation[t].X,this.DotLocation[t].Y),this.Lines.push({...this.OnDrawingLine}),this.OnDrawing=!1,this.OnDrawingLine={points:[],stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"},this.$refs.LineLayer.getNode().draw(),this.$refs.OnDrawLineLayer.getNode().draw();return}this.OnDrawing=!1,this.OnDrawingLine={points:[],stroke:"black",strokeWidth:2,lineCap:"round",lineJoin:"round"},this.$refs.OnDrawLineLayer.getNode().draw()}},CheckMouseAtTheDot(a,n){for(var t in this.DotLocation){let i=this.DotLocation[t],e=7;if(a>i.X-e&&a<i.X+e&&n>i.Y-e&&n<i.Y+e)return parseInt(t)}return!1},MappingDotIndexToAnswerIndex(a){return this.IndexMappingTable[a]},CheckLinkAble(a,n){console.log(a,n);let t=this.MappingDotIndexToAnswerIndex(a)[0],i=this.MappingDotIndexToAnswerIndex(n)[0];return t==i?(console.log("Same Column"),!1):(console.log("Different Column"),!0)},CheckAnswerisCorrect(a,n){let t=this.GameData.Answer,i=this.MappingDotIndexToAnswerIndex(a),e=this.MappingDotIndexToAnswerIndex(n);console.log(i,e);for(var o in t){if(t[o][0][0]==i[0]&&t[o][0][1]==i[1]&&t[o][1][0]==e[0]&&t[o][1][1]==e[1])return this.$emit("play-effect","CorrectSound"),this.$emit("add-record",[this.GameData.Answer,[i,e],"正確"]),!0;if(t[o][0][0]==e[0]&&t[o][0][1]==e[1]&&t[o][1][0]==i[0]&&t[o][1][1]==i[1])return this.$emit("play-effect","CorrectSound"),this.$emit("add-record",[this.GameData.Answer,[i,e],"正確"]),!0}return console.log("Wrong"),this.$emit("play-effect","WrongSound"),this.$emit("add-record",[this.GameData.Answer,[i,e],"錯誤"]),!1},CheckAll(){this.Lines.length==this.GameData.Answer.length},Init(){let n=this.$refs.KonvaContainer.getBoundingClientRect();this.configStage.width=n.width,this.configStage.height=n.height;let t=this.GameData.Question.RowData.length;this.ComponentPositionConfig.ObjectWidth=n.width/(t*2+(t-1)*3)*2,this.ComponentPositionConfig.BlankWidth=n.width/(t*2+(t-1)*3)*3;let i=0,e=0;this.DotLocation=[],this.IndexMappingTable=[];for(var o in this.GameData.Question.RowData){let c=this.GameData.Question.RowData[o].length;this.ComponentPositionConfig.ObjectHeight=(n.height-this.MiniGap*(c+1))/c;let s=this.MiniGap;for(var h in this.GameData.Question.RowData[o]){let l={};l.X=i,l.Y=s,l.Name=this.GameData.Question.RowData[o][h].Name,l.Data=this.GameData.Question.RowData[o][h].Data,o!=0&&o!=this.GameData.Question.RowData.length-1?(this.IndexMappingTable.push([parseInt(e+1),parseInt(h)]),this.DotLocation.push({X:i+this.ComponentPositionConfig.ObjectWidth+this.MiniGap,Y:s+this.ComponentPositionConfig.ObjectHeight/2}),this.IndexMappingTable.push([parseInt(e),parseInt(h)]),this.DotLocation.push({X:i-this.MiniGap,Y:s+this.ComponentPositionConfig.ObjectHeight/2})):o==0?(this.IndexMappingTable.push([parseInt(e),parseInt(h)]),this.DotLocation.push({X:i+this.ComponentPositionConfig.ObjectWidth+this.MiniGap,Y:s+this.ComponentPositionConfig.ObjectHeight/2})):o==this.GameData.Question.RowData.length-1&&(this.IndexMappingTable.push([parseInt(e),parseInt(h)]),this.DotLocation.push({X:i-this.MiniGap,Y:s+this.ComponentPositionConfig.ObjectHeight/2})),s+=this.ComponentPositionConfig.ObjectHeight+this.MiniGap,this.ComponentConfig.push(l)}i+=this.ComponentPositionConfig.ObjectWidth+this.ComponentPositionConfig.BlankWidth,o!=0&&o!=this.GameData.Question.RowData.length-1?(console.log("Add 2"),e+=2):(console.log("Add 1"),e+=1)}}}},N={class:"Container"},O={class:"h1"},P={class:"Index",ref:"Index"},y={class:"Konva-container",ref:"KonvaContainer"};function A(a,n,t,i,e,o){const h=u("v-circle"),c=u("v-layer"),s=u("v-line"),l=u("v-stage");return g(),p("div",N,[f("p",O,M(e.GameData.Question.text),1),k(" "+M(e.IndexMappingTable)+" ",1),f("div",P,[f("div",y,[D(l,{config:e.configStage,class:"Stage",onMousemove:o.MouseMove,onMouseup:o.MouseUpAtDot},{default:m(()=>[D(c,null,{default:m(()=>[(g(!0),p(C,null,w(e.DotLocation,(r,d)=>(g(),_(h,{onMousedown:L=>{o.MouseDown(L,d)},key:d,config:{x:r.X,y:r.Y,radius:5,fill:"black"}},null,8,["onMousedown","config"]))),128))]),_:1}),D(c,{ref:"LineLayer"},{default:m(()=>[(g(!0),p(C,null,w(e.Lines,r=>(g(),_(s,{config:r},null,8,["config"]))),256))]),_:1},512),D(c,{ref:"OnDrawLineLayer"},{default:m(()=>[D(s,{config:e.OnDrawingLine},null,8,["config"])]),_:1},512)]),_:1},8,["config","onMousemove","onMouseup"])],512),(g(!0),p(C,null,w(e.ComponentConfig,(r,d)=>(g(),p("div",{class:"ObjectContainer",ref_for:!0,ref:"ObjectContainer",style:v({position:"absolute",top:r.Y+"px",left:r.X+"px",width:this.ComponentPositionConfig.ObjectWidth+"px",height:this.ComponentPositionConfig.ObjectHeight+"px"})},[(g(),_(S(r.Name),{Data:r.Data,ID:this.id,class:"Component"},null,8,["Data","ID"]))],4))),256))],512)])}const R=x(G,[["render",A],["__scopeId","data-v-277884b2"]]);export{R as default};
