import{r as g,o as h,c as u,b as f,w as m,a as p,j as k,F as M,k as R,q as L,p as y,e as D}from"./index-d6735393.js";/* empty css                                                                    */import{_ as I}from"./_plugin-vue_export-helper-c27b6911.js";const G={name:"LinktoImage",props:{GameData:{type:Object,required:!0},GameConfig:{type:Object,required:!0},id:{type:String,required:!0}},data(){return{stageConfig:{width:1e3,height:600},Rects:[],Lines:[],Texts:[],LineLayer:[],OnDrawingLine:{},ImageConfig:{},ImageMountPoint:[],MinGap:10,OnDrawingRectIndex:null,OnDrawing:!1,Pair:[],FontSize:20,LinkedRecord:[],SelectionHeight:80,RectCornerRaduis:15,ErrorMesseagesSwitch:{AllAnswerNotFinish:!1,WrongAnswer:!1}}},methods:{StartDrawing(t){this.OnDrawingRectIndex=t,this.OnDrawing=!0,this.ErrorMesseagesSwitch.WrongAnswer=!1;const e={points:[this.Rects[t].x+this.Rects[t].width/2,this.Rects[t].y+this.Rects[t].height/2,this.Rects[t].x+this.Rects[t].width/2,this.Rects[t].y+this.Rects[t].height/2],stroke:"black",strokeWidth:10,lineCap:"round",lineJoin:"round"};this.Lines.push(e),this.currentLine=e},Drawing(t){if(this.OnDrawing&&this.currentLine){let e=this.$refs.stage.getNode().getPointerPosition();this.currentLine.points.splice(2,2,e.x,e.y),this.$refs.LineLayer.getNode().batchDraw()}},EndDrawing(t){if(!this.OnDrawing)return;let e=this.$refs.stage.getNode().getPointerPosition(),i=this.WhichMountPoint(e.x,e.y),n=this.CheckPairedBefore(this.OnDrawingRectIndex,i);i===-1||n?this.Lines.pop():this.currentLine.points.splice(2,2,this.ImageMountPoint[i].x,this.ImageMountPoint[i].y),i!=-1&&n!=!0&&this.LinkedRecord.push([this.OnDrawingRectIndex,i]),this.OnDrawing=!1,this.currentLine=null,this.$refs.LineLayer.getNode().batchDraw()},WhichMountPoint(t,e){for(let i=0;i<this.ImageMountPoint.length;i++)if(Math.pow(t-this.ImageMountPoint[i].x,2)+Math.pow(e-this.ImageMountPoint[i].y,2)<Math.pow(this.ImageMountPoint[i].radius,2))return i;return-1},CheckPairedBefore(t,e){for(let i in this.LinkedRecord)if(this.LinkedRecord[i][0]==t&&this.LinkedRecord[i][1]==e)return!0;return!1},MarkWrongLine(t,e){let i={points:[this.Rects[t].x+this.Rects[t].width/2,this.Rects[t].y+this.Rects[t].height/2,this.ImageMountPoint[e].x,this.ImageMountPoint[e].y],stroke:"red",strokeWidth:10,lineCap:"round",lineJoin:"round"};for(let n in this.Lines)this.Lines[n].points[0]==i.points[0]&&this.Lines[n].points[1]==i.points[1]&&(this.Lines[n]=i)},CheckAllAnswer(){let t=[],e=0,i=!1;for(let n in this.LinkedRecord){let o=!1;for(let s in this.Pair)this.LinkedRecord[n][0]==this.Pair[s][1]&&this.LinkedRecord[n][1]==this.Pair[s][0]&&(o=!0);o==!1&&(t.push(n),e++,this.ErrorMesseagesSwitch.WrongAnswer=!0,this.MarkWrongLine(this.LinkedRecord[n][0],this.LinkedRecord[n][1]))}return this.LinkedRecord.length!=this.Pair.length?this.ErrorMesseagesSwitch.AllAnswerNotFinish=!0:this.ErrorMesseagesSwitch.AllAnswerNotFinish=!1,this.LinkedRecord.length==this.Pair.length&&e==0?(console.log("Pass"),i=!0):(console.log("Not Pass"),i=!1),{WrongAmount:e,WrongAnsIndexs:t,Pass:i}},Pop(){this.LinkedRecord.length>0&&(this.LinkedRecord.pop(),this.Lines.pop(),this.$refs.LineLayer.getNode().batchDraw())},ClearAll(){this.LinkedRecord=[],this.Lines=[],this.$refs.LineLayer.getNode().batchDraw()},InitAnswer(){}},created(){let t=new window.Image;if(t.src=this.GameData.BGSrc,t.onload=()=>{let e=this.stageConfig.height-this.SelectionHeight*2,i=t.width,n=t.height,o=i/n,s,l;this.stageConfig.width/e>o?(l=e-30,s=l*o):(s=this.stageConfig.width-30,l=s/o);let d=(this.stageConfig.width-s)/2,c=(e-l)/2;console.log(d,c),this.ImageConfig={image:t,width:s,height:l,x:d,y:c+this.SelectionHeight},console.log(this.ImageConfig.x,this.ImageConfig.y),this.GameData.MountPoint.forEach(w=>{this.ImageMountPoint.push({x:w.X+d,y:w.Y+c+this.SelectionHeight,radius:10,fill:"yellow"})})},this.GameData.Selections.length<=4){let e=(this.stageConfig.width-(this.GameData.Selections.length+1)*this.MinGap)/this.GameData.Selections.length;this.GameData.Selections.forEach((i,n)=>{this.Rects.push({x:this.MinGap+n*(e+this.MinGap),y:500,width:e,cornerRadius:this.RectCornerRaduis,height:100,fill:"red"}),this.Texts.push({x:this.MinGap+n*(e+this.MinGap)+e/2,y:540,text:i,align:"center",fontSize:this.FontSize})})}else{let e=(this.stageConfig.width-(this.GameData.Selections.length/2+1)*this.MinGap)/(this.GameData.Selections.length/2);this.GameData.Selections.forEach((i,n)=>{n%2==0?(this.Rects.push({x:this.MinGap+parseInt(n/2)*(e+this.MinGap),y:0,width:e,height:100,cornerRadius:this.RectCornerRaduis,fill:"red"}),this.Texts.push({x:this.MinGap+parseInt(n/2)*(e+this.MinGap)+e/2,y:40,text:i,align:"center",fontSize:this.FontSize})):(this.Rects.push({x:this.MinGap+parseInt(n/2)*(e+this.MinGap),y:500,width:e,height:100,cornerRadius:this.RectCornerRaduis,fill:"blue"}),this.Texts.push({x:this.MinGap+parseInt(n/2)*(e+this.MinGap)+e/2,y:540,text:i,align:"center",fontSize:this.FontSize}))})}this.Pair=[];for(let e in this.GameData.MountPoint)for(let i in this.GameData.Selections)if(typeof this.GameData.MountPoint[e].Connect2=="string")this.GameData.MountPoint[e].Connect2==this.GameData.Selections[i]&&this.Pair.push([e,i]);else for(let n in this.GameData.MountPoint[e].Connect2)this.GameData.MountPoint[e].Connect2[n]==this.GameData.Selections[i]&&this.Pair.push([e,i])},mounted(){this.InitAnswer();let t=this.$refs.layer.getNode();t.moveToBottom(),t.draw();let e=this.$refs.RectContainer.getNode();e.moveToTop(),e.draw()}},S=t=>(y("data-v-89d4427b"),t=t(),D(),t),A={class:"OutterContainer"},v={class:"Functions"},x={key:0},N={key:1},W=S(()=>p("p",null,null,-1));function b(t,e,i,n,o,s){const l=g("v-rect"),d=g("v-text"),c=g("v-layer"),w=g("v-image"),P=g("v-circle"),C=g("v-line"),_=g("v-stage");return h(),u("div",A,[f(_,{ref:"stage",config:o.stageConfig,onMousemove:s.Drawing,onMouseup:s.EndDrawing},{default:m(()=>[f(c,{ref:"RectContainer"},{default:m(()=>[(h(!0),u(M,null,R(o.Rects,(r,a)=>(h(),L(l,{key:a,config:r,onMousedown:E=>s.StartDrawing(a)},null,8,["config","onMousedown"]))),128)),(h(!0),u(M,null,R(o.Texts,(r,a)=>(h(),L(d,{key:a,config:r},null,8,["config"]))),128))]),_:1},512),f(c,{ref:"layer"},{default:m(()=>[f(w,{config:o.ImageConfig},null,8,["config"]),(h(!0),u(M,null,R(o.ImageMountPoint,(r,a)=>(h(),L(P,{key:a,config:r},null,8,["config"]))),128))]),_:1},512),f(c,{ref:"LineLayer"},{default:m(()=>[(h(!0),u(M,null,R(o.Lines,(r,a)=>(h(),L(C,{key:a,config:r},null,8,["config"]))),128))]),_:1},512)]),_:1},8,["config","onMousemove","onMouseup"]),p("div",v,[p("button",{onClick:e[0]||(e[0]=(...r)=>s.CheckAllAnswer&&s.CheckAllAnswer(...r))},"檢查答案"),p("button",{onClick:e[1]||(e[1]=(...r)=>s.ClearAll&&s.ClearAll(...r))},"清除所有答案"),p("button",{onClick:e[2]||(e[2]=(...r)=>s.Pop&&s.Pop(...r))},"清除最後一個"),o.ErrorMesseagesSwitch.AllAnswerNotFinish?(h(),u("p",x,"所有答案尚未完成")):k("",!0),o.ErrorMesseagesSwitch.WrongAnswer?(h(),u("p",N,"答案有誤")):k("",!0)]),W])}const T=I(G,[["render",b],["__scopeId","data-v-89d4427b"]]);export{T as default};
